/* =========================================
   NAVIGATION CSS (tight pill + rounded drawer + full-viewport blur)
   ========================================= */

/* =========================================
   0) ROOT VARIABLES / OFFSETS
   ========================================= */
:root {
  /* Heights (no longer force the nav; used mainly for body padding fallback) */
  --nav-h-desktop: 30px;
  --nav-h-mobile: 60px;
  --nav-h: var(--nav-h-desktop);
  --nav-top-gap: 15px;

  /* Pill background tuning (tighter) */
  --nav-pill-edge-gap: clamp(12px, 4vw, 48px);
  --nav-pill-pad-y: 2px; /* legacy token; no longer used for pill size */
  --nav-pill-shadow: 0 1px 2px rgba(0, 0, 0, 0.08);

  /* Shared horizontal pad for both content and pill edges */
  --nav-x-pad-desktop: clamp(16px, 3vw, 24px);
  --nav-x-pad-mobile: clamp(12px, 4vw, 20px);
  --nav-x-pad: var(--nav-x-pad-desktop);

  /* Micro-nudge so brand never kisses the pill edge */
  --brand-offset-x: 10px;

  /* Drawer geometry */
  --drawer-gap-top: 20px; /* space under nav */
  --drawer-gap-bottom: 8svh; /* do not reach bottom */
  --drawer-radius: 18px; /* rounded edges */
  --drawer-blur: 10px; /* backdrop blur strength */
  --drawer-shadow: -18px 0 28px rgba(0, 0, 0, 0.18);
  --nav-pill-nudge-y: 0px; /* no artificial vertical offset */

  /* Pill is content height + this total allowance (top+bottom) */
  /* Slightly taller on desktop vs your last version */
  --pill-extra: -6px;
}
@media (max-width: 900px) {
  :root {
    --nav-h: var(--nav-h-mobile);
    --nav-pill-edge-gap: clamp(8px, 5vw, 20px);
    --nav-x-pad: var(--nav-x-pad-mobile);
    /* Slightly taller pill on mobile by reducing inset */
    --pill-extra: 3px;
  }
}

/* =========================================
   1) GLOBAL PAGE OFFSETS
   ========================================= */
html {
  scroll-behavior: smooth;
}
body {
  /* account for the nav’s top gap so content never sits under the nav */
  padding-top: calc(var(--nav-h) + var(--nav-top-gap));
}

/* =========================================
   2) PRIMARY NAV BAR + PILL BACKGROUND
   ========================================= */
.primary-nav {
  position: fixed;
  inset: var(--nav-top-gap) 0 auto 0;
  z-index: 10000; /* above page, below drawer */
  background: transparent; /* pill supplies the surface */
  border-bottom: 1px solid transparent; /* divider on scroll/open */
  transition: border-color 200ms ease;
  padding-left: max(0px, env(safe-area-inset-left));
  padding-right: max(0px, env(safe-area-inset-right));
  isolation: isolate; /* make own stacking context */

  /* Let the nav height be determined by its content */
  display: grid;
  align-items: center;
}

/* Pill that hugs content by using top/bottom insets (no fixed height) */
.primary-nav::before {
  content: "";
  position: absolute;
  left: calc(var(--nav-x-pad) + max(0px, env(safe-area-inset-left)));
  right: calc(var(--nav-x-pad) + max(0px, env(safe-area-inset-right)));

  /* pill block-size = nav height minus 2 * --pill-extra */
  top: var(--pill-extra);
  bottom: var(--pill-extra);

  background: var(--background-color);
  border: 1px solid var(--border);
  border-radius: 9999px;
  box-shadow: var(--nav-pill-shadow);
  z-index: 2; /* above nav blur, below content */
  will-change: transform;
  backface-visibility: hidden;
}

/* Divider when scrolled or menu open */
.primary-nav.is-scrolled,
.primary-nav.is-open {
  border-bottom-color: color-mix(in srgb, var(--secondary), transparent 90%);
}

/* =========================================
   3) NAV INNER GRID (DESKTOP DEFAULT)
   ========================================= */
.primary-nav .nav-inner {
  position: relative;
  z-index: 3; /* links/logo above pill and blur */
  display: grid;
  grid-template-columns: 220px 1fr auto auto;
  align-items: center;
  gap: 0.6rem;
  padding: 0.18rem var(--nav-x-pad); /* trimmed to avoid bloating pill */
}

/* =========================================
   4) BRAND
   ========================================= */
.brand {
  font-weight: 500;
  font-size: clamp(1.35rem, 0.9rem + 1vw, 2.1rem);
  line-height: 1; /* keeps computed height tight */
  text-decoration: none;
  color: var(--secondary);
  letter-spacing: 0.2px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  margin-left: var(--brand-offset-x);
}
.brand span {
  font-weight: 500;
}
.brand:focus-visible {
  outline: 2px solid currentColor;
  outline-offset: 3px;
  border-radius: 6px;
}

/* =========================================
   5) CENTER PILL NAV (DESKTOP ONLY, TIGHTER)
   ========================================= */
.nav-center-card {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.45rem; /* tighter gap */

  padding: 0.08rem 0.5rem; /* minimal vertical padding */
  z-index: 1;
}
.nav-center-card a {
  text-decoration: none;
  color: var(--secondary);
  font-size: 0.95rem;
  padding: 0.12rem 0.5rem; /* small; avoids forcing pill taller */
  border-radius: 9999px;
  transition: background-color 150ms ease, opacity 150ms ease;
  white-space: nowrap;
  line-height: 1.05;
}
.nav-center-card a[aria-current="page"] {
  background: color-mix(in srgb, var(--accent), transparent 60%);
  font-weight: 500;
}
.nav-center-card a:hover {
  background: color-mix(in srgb, var(--accent), transparent 60%);
}
.nav-center-card a:focus-visible {
  outline: 2px solid currentColor;
  outline-offset: 2px;
}

/* =========================================
   6) CTA BUTTON (DESKTOP)
   ========================================= */
.nav-cta {
  white-space: nowrap;
  justify-self: end;
}

/* =========================================
   7) PHONE LINK (DESKTOP)
   ========================================= */
.nav-phone {
  display: inline-flex;
  align-items: center;
  justify-self: end;
  gap: 0.45rem;
  text-decoration: none;
  color: var(--secondary);
  font-weight: 300;
}
.nav-phone img {
  width: 1.25rem;
  height: 1.25rem;
  display: inline-block;
  fill: currentColor;
  color: var(--accent);
}
.nav-phone span {
  display: inline;
}

/* Hover wobble (desktop only) */
@media (hover: hover) and (pointer: fine) {
  .nav-phone:hover img {
    animation: wobble 0.6s ease-in-out;
    filter: hue-rotate(120deg) saturate(1.4);
  }
}
@keyframes wobble {
  0% {
    transform: rotate(0deg);
  }
  15% {
    transform: rotate(-15deg);
  }
  30% {
    transform: rotate(12deg);
  }
  45% {
    transform: rotate(-10deg);
  }
  60% {
    transform: rotate(8deg);
  }
  75% {
    transform: rotate(-6deg);
  }
  100% {
    transform: rotate(0deg);
  }
}

/* =========================================
   8) HAMBURGER TOGGLE (SMALLER)
   ========================================= */
.nav-toggle {
  display: none;
  background: none;
  border: none;
  cursor: pointer;
  padding: 0.15rem; /* snug */
  color: var(--secondary);
  line-height: 0;
  position: relative;
  width: 28px;
  height: 28px; /* smaller button */
  overflow: visible;
}
.nav-toggle .burger {
  position: relative;
  width: 20px;
  height: 14px; /* smaller icon */
  display: inline-block;
}
.nav-toggle .burger i {
  position: absolute;
  left: 0;
  width: 100%;
  height: 2px; /* slimmer lines */
  background: var(--secondary, #222);
  border-radius: 1px;
  transition: transform 300ms cubic-bezier(0.25, 0.8, 0.25, 1),
    top 300ms cubic-bezier(0.25, 0.8, 0.25, 1), opacity 200ms ease;
}
.nav-toggle .burger i:nth-child(1) {
  top: 0;
}
.nav-toggle .burger i:nth-child(2) {
  top: 7px;
}
.nav-toggle .burger i:nth-child(3) {
  top: 14px;
}
.nav-toggle[aria-expanded="true"] .burger i:nth-child(1) {
  top: 7px;
  transform: rotate(45deg);
}
.nav-toggle[aria-expanded="true"] .burger i:nth-child(2) {
  opacity: 0;
  transform: scaleX(0.6);
}
.nav-toggle[aria-expanded="true"] .burger i:nth-child(3) {
  top: 7px;
  transform: rotate(-45deg);
}
@media (prefers-reduced-motion: reduce) {
  .nav-toggle .burger i {
    transition: none !important;
  }
}

/* =========================================
   9) MOBILE / TABLET (<=900px)
   ========================================= */
@media (max-width: 900px) {
  .primary-nav .nav-inner {
    grid-template-columns: auto 1fr auto auto;
    column-gap: 0.6rem;
    padding: 0.12rem var(--nav-x-pad); /* very slim block padding */
  }
  .brand {
    font-size: clamp(1.25rem, 0.9rem + 2.2vw, 1.9rem);
    max-width: 60vw;
  }
  .nav-center-card,
  .nav-cta {
    display: none !important;
  }

  .nav-phone {
    grid-column: 3;
    justify-self: end;
    display: inline-flex;
    align-items: center;
    font-weight: 300;
    color: var(--secondary);
    padding: 0.02rem 0.1rem; /* minimal to avoid inflating pill */
    border-radius: 8px;
    gap: 0.5rem;
  }
  .nav-phone span {
    display: none;
  }
  .nav-phone img {
    display: inline-block;
  }

  .nav-toggle {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    grid-column: 4;
  }

  /* Drawer: rounded, not full height, blur everything behind it */
  .nav-menu {
    position: fixed;
    right: clamp(8px, 3vw, 16px);
    left: auto;
    top: calc(var(--nav-h) + var(--drawer-gap-top) + var(--nav-top-gap));
    bottom: calc(var(--drawer-gap-bottom) + env(safe-area-inset-bottom));
    width: min(64svw, 480px);
    background: var(--accent);
    border-radius: var(--drawer-radius);
    box-shadow: var(--drawer-shadow);
    padding: 1.1rem clamp(16px, 4vw, 28px);
    overflow: auto;
    overscroll-behavior: contain;
    transform: translate3d(calc(100% + 24px), 0, 0);
    opacity: 1;
    visibility: hidden;
    transition: transform 700ms cubic-bezier(0.22, 0.61, 0.36, 1),
      visibility 0s linear 700ms;
    z-index: 10002; /* above scrim and nav */
    will-change: transform;
    backface-visibility: hidden;
    contain: paint;
  }
  .primary-nav.is-open .nav-menu {
    transform: translate3d(0, 0, 0);
    visibility: visible;
    transition: transform 700ms cubic-bezier(0.22, 0.61, 0.36, 1), visibility 0s;
  }
  .nav-menu::before {
    /* subtle inner edge highlight */
    content: "";
    position: absolute;
    top: 0;
    bottom: 0;
    left: -18px;
    width: 18px;
    pointer-events: none;
    -webkit-backdrop-filter: blur(8px);
    backdrop-filter: blur(8px);
    background: linear-gradient(to left, rgba(0, 0, 0, 0.12), rgba(0, 0, 0, 0));
    border-top-left-radius: var(--drawer-radius);
    border-bottom-left-radius: var(--drawer-radius);
  }

  /* Drawer list */
  .nav-menu .nav-list {
    list-style: none;
    margin: 0;
    padding: 0;
    display: grid;
    gap: 0.9rem;
  }
  .nav-menu .nav-list a {
    text-align: left;
    display: block;
    font-weight: 600;
    text-decoration: none;
    font-size: clamp(1.15rem, 3vw, 1.45rem);
    padding: 0.5rem 0;
    color: var(--background-color);
    border-bottom: 1px solid
      color-mix(in srgb, var(--secondary), transparent 90%);
  }
  .nav-menu .nav-list a:last-child {
    border-bottom: none;
  }

  /* Email pills in drawer */
  .primary-nav .nav-menu .nav-list a.email {
    display: inline-block;
    font-size: clamp(0.95rem, 2.4vw, 1.05rem) !important;
    font-weight: 300 !important;
    opacity: 0.9 !important;
    letter-spacing: 0.2px !important;
    line-height: 1.1 !important;
    padding: 0.45rem 0.7rem;
    border-radius: 9999px;
    background: color-mix(in srgb, var(--secondary), transparent 75%);
    border: 1px solid color-mix(in srgb, var(--secondary), transparent 80%);
    text-decoration: none;
    border-bottom: none !important;
  }
  .primary-nav .nav-menu .nav-list li:has(> a.email) + li:has(> a.email) {
    margin-top: -0.5rem; /* tighten just between two email pills */
  }

  /* SCRIM: blur the WHOLE page except nav pill and drawer
     - Full-viewport coverage (ignores nav height and top-gap)
     - Lives behind the nav within its stacking context so the pill stays crisp
     - Drawer sits above it via higher z-index
  */
  .primary-nav .nav-scrim {
    position: fixed;
    inset: -6px; /* full-viewport with overscan to kill seams */
    z-index: -1; /* behind nav’s stacking context so pill stays crisp */
    background: rgba(
      255,
      255,
      255,
      0.001
    ); /* keeps WebKit rendering backdrop */
    -webkit-backdrop-filter: blur(var(--drawer-blur)) brightness(1);
    backdrop-filter: blur(var(--drawer-blur)) brightness(1);
    opacity: 0;
    visibility: hidden;
    transition: opacity 300ms ease, visibility 0s linear 300ms;
    will-change: opacity;
    backface-visibility: hidden;
    pointer-events: none;
    transform: translateZ(0);
  }
  .primary-nav.is-open .nav-scrim {
    opacity: 1;
    visibility: visible;
    transition: opacity 300ms ease, visibility 0s;
  }

  /* Move scroll indicator up slightly on mobile so it’s not hugging the edge */
  .scroll-indicator {
    bottom: calc(10px + max(14px, env(safe-area-inset-bottom) + 8px));
  }
}

/* Even smaller phones get a proportional bump too */
@media (max-width: 420px) {
  .scroll-indicator {
    bottom: calc(8px + max(12px, env(safe-area-inset-bottom) + 6px));
  }
}

/* =========================================
   10) VERY SMALL PHONES (<=360px)
   ========================================= */
@media (max-width: 360px) {
  .nav-phone {
    display: none;
  }
  .primary-nav .nav-inner {
    grid-template-columns: auto 1fr auto;
  }
  .nav-toggle {
    grid-column: 3;
    justify-self: end;
  }
}

/* =========================================
   11) TOUCH POLISH (TABLET LANDSCAPE ETC.)
   ========================================= */
@media (hover: none) and (pointer: coarse) {
  .primary-nav .nav-inner {
    grid-template-columns: 220px 1fr auto auto;
    column-gap: 0.6rem;
    padding-left: max(12px, env(safe-area-inset-left));
    padding-right: max(12px, env(safe-area-inset-right));
    padding-top: max(0.2rem, env(safe-area-inset-top));
    padding-bottom: 0.2rem;
  }
  .nav-center-card {
    display: none;
  }
  .brand {
    font-size: clamp(1.25rem, 0.9rem + 2.2vw, 1.9rem);
    max-width: 60vw;
  }
}

/* =========================================
   12) DESKTOP HOTFIX REMOVED: let height follow content
   ========================================= */
/* Keep center pill vertically centered relative to the nav */
@media (min-width: 901px) {
  .primary-nav .nav-inner {
    align-items: center;
    padding-block: 0.18rem; /* small, doesn’t inflate pill */
  }
  .nav-center-card {
    top: 50%;
    transform: translate(-50%, -50%);
  }
}

/* =========================================
   13) ACCESSIBILITY OUTLINES
   ========================================= */
.primary-nav a:focus-visible,
.nav-toggle:focus-visible,
.nav-phone:focus-visible {
  outline: 2px solid var(--primary);
  outline-offset: 2px;
  border-radius: 4px;
}
@media (prefers-reduced-motion: reduce) {
  .nav-menu,
  .nav-toggle .burger i {
    transition: none !important;
  }
}

/* =========================================
   14) BASE BUTTONS (SLIMMER)
   ========================================= */
.btn-black,
.btn-cta {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  background: var(--secondary);
  color: var(--background-color);
  padding: 0.38rem 0.9rem; /* slimmer */
  border: none;
  border-radius: 9999px;
  font-size: 0.95rem;
  line-height: 1;
  text-decoration: none;
  white-space: nowrap;
  transition: transform 0.25s ease;
  cursor: pointer;
}
.btn-cta {
  font-size: 1.5rem !important;
  font-weight: 600 !important;
  background: var(--accent) !important;
  color: var(--secondary) !important;
  margin-left: 1rem;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25), 0 6px 24px rgba(0, 0, 0, 0.2);
}
.btn-black:hover,
.btn-cta:hover {
  transform: scale(1.1);
}
.btn-black:active,
.btn-cta:active {
  transform: scale(1);
}
@media (max-width: 600px) {
  .btn-black,
  .btn-cta {
    font-size: 0.9rem !important;
    padding: 0.34rem 0.85rem;
    transform: none;
  }
}

/* =========================================
   15) FOOTER
   ========================================= */
#site-footer {
  background-color: var(--secondary);
  color: var(--text);
  width: 100%;
  margin: 0;
  padding: clamp(2rem, 4vw, 3rem) 0;
  font-family: var(--font-body, "Albert Sans", sans-serif);
  border-top: 1px solid color-mix(in srgb, var(--text), transparent 85%);
}
.footer-inner {
  max-width: 100%;
  margin: 0 auto;
  display: grid;
  grid-template-columns: auto 1fr auto;
  align-items: center;
  gap: 1rem;
  padding: 0 1.5rem;
}
.footer-brand {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: 0.5rem;
}
.footer-logo {
  width: 220px;
  height: auto;
  margin: 0;
  padding: 0;
  opacity: 0.95;
}
.footer-tagline {
  font-size: 0.9rem;
  color: color-mix(in srgb, var(--text), transparent 30%);
  margin: 0;
}
.footer-nav ul {
  list-style: none;
  display: flex;
  gap: 1.5rem;
  margin: 0;
  padding: 0;
  justify-content: center;
}
.footer-nav a {
  color: var(--text);
  text-decoration: none;
  font-size: 0.95rem;
  transition: opacity 0.2s ease;
}
.footer-nav a:hover {
  opacity: 0.7;
}
.footer-meta p {
  text-align: right;
  font-size: 0.85rem;
  color: color-mix(in srgb, var(--text), transparent 30%);
}
@media (max-width: 700px) {
  .footer-inner {
    grid-template-columns: 1fr;
    text-align: center;
    gap: 1.2rem;
    padding: 0 1rem;
  }
  .footer-brand {
    align-items: center;
  }
  .footer-meta {
    text-align: center;
  }
  .footer-nav ul {
    justify-content: center;
    flex-wrap: wrap;
  }
  .footer-logo {
    margin: 0 auto;
  }
}

/* =========================================
   16) HERO + SCROLL INDICATOR
   ========================================= */
.hero {
  position: relative;
}

/* =========================================
   17) EMAIL PILLS (GLOBAL FALLBACK, NON-MOBILE PREVIEWS)
   ========================================= */
.primary-nav .nav-menu .nav-list a.email {
  display: inline-block;
  padding: 0.4rem 0.7rem;
  border-radius: 9999px;
  background: color-mix(in srgb, var(--secondary), transparent 75%);
  border: 1px solid color-mix(in srgb, var(--secondary), transparent 80%);
  text-decoration: none;
  border-bottom: none !important;
}

/* =========================================
   NAV-ONLY BLUR WHEN OPEN (SEAMLESS WITH SCRIM)
   ========================================= */

/* Default: no nav-local blur */
.primary-nav::after {
  content: none;
}

/* When OPEN: add a nav-local blur layer under the pill so the excess around the pill blurs, but not the pill itself. */
.primary-nav.is-open::after {
  content: "";
  position: absolute;
  inset: -6px; /* overscan to overlap scrim */
  -webkit-backdrop-filter: blur(var(--drawer-blur)) brightness(1);
  backdrop-filter: blur(var(--drawer-blur)) brightness(1);
  background: rgba(
    255,
    255,
    255,
    0.001
  ); /* keeps WebKit rendering without darkening */
  z-index: 1; /* pill is z:2, content z:3 */
  pointer-events: none;
  will-change: transform;
  backface-visibility: hidden;
  transform: translateZ(0);
}

/* Keep the pill crisp above the nav blur */
.primary-nav::before {
  z-index: 2;
}
.primary-nav .nav-inner {
  z-index: 3;
}

/* Safety: shared blur token */
.nav-menu,
.nav-scrim,
.primary-nav::after {
  --drawer-blur: 10px;
}

@media (max-width: 900px) {
  :root {
    --pill-extra: -2px !important;
  }
  .primary-nav .nav-inner {
    padding-left: 18px !important; /* nudge left edge */
    padding-right: 25px !important; /* nudge right edge */
  }
}
/* =========================================
   MOBILE: GRADIENT BORDER AROUND NAV PILL
   ========================================= */
@media (max-width: 900px) {
  .primary-nav::before {
    border: none;

    /* smoother alternating conic gradient */
    background: linear-gradient(
          var(--background-color),
          var(--background-color)
        )
        padding-box,
      conic-gradient(
          from 45deg,
          var(--accent) 0%,
          color-mix(in srgb, var(--accent) 70%, var(--background-color) 30%) 20%,
          var(--background-color) 40%,
          color-mix(in srgb, var(--background-color) 70%, var(--accent) 30%) 60%,
          var(--accent) 80%,
          color-mix(in srgb, var(--accent) 60%, white 20%) 100%
        )
        border-box;

    border: 3px solid transparent;
    border-radius: 9999px;

    /* subtle lift shadow */
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08), 0 4px 12px rgba(0, 0, 0, 0.06);
  }
}
